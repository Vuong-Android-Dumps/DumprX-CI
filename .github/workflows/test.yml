name: Workflow with 128GB Space

on:
  push:
    branches:
      - main

jobs:
  big-disk-job:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v3

    # -------------------------------
    # Step 1: Clean up runner space
    # -------------------------------
    - name: Clean apt cache
      run: sudo apt-get clean

    - name: Remove unused packages
      run: sudo apt-get autoremove -y

    - name: Remove old Docker containers/images
      run: |
        docker rm -f $(docker ps -aq) || true
        docker rmi -f $(docker images -aq) || true
        docker system prune -af
        docker volume prune -f

    - name: Clean Git
      run: git clean -fdx

    - name: Check free disk space
      run: df -h

    # -------------------------------
    # Step 2: Mount external 128GB storage
    # -------------------------------
    - name: Install NFS client
      run: sudo apt-get install -y nfs-common

    - name: Mount NFS volume
      run: |
        sudo mkdir -p /mnt/bigdisk
        sudo mount -t nfs4 <NFS_SERVER>:/exported/path /mnt/bigdisk

    - name: Verify mount
      run: df -h /mnt/bigdisk

    # -------------------------------
    # Step 3: Run your commands
    # -------------------------------
    - name: Run commands on big disk
      run: |
        echo "Creating test file..."
        fallocate -l 10G /mnt/bigdisk/testfile.bin
        ls -lh /mnt/bigdisk
